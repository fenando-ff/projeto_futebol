{% extends "base.html" %}
{% load static %}

{% block css_extra %}
  <link rel="stylesheet" href="{% static 'css/proximos_jogos.css' %}">
  <link rel="stylesheet" href="{% static 'css/Tela_Ingressos.css' %}">
{% endblock css_extra %}

{% block titulo %}Ingressos{% endblock titulo %}

{% block conteudo_pagina %}

<!-- ================= JOGO EM DESTAQUE ================= -->
<section class="jogo-destaque">
  {% if jogo_destaque %}
  <p class="rodada">PRÓXIMO JOGO</p>

  <div class="confronto">
    <div class="time">
      <img src="{% static 'img/icones/Escudo_Drakos.png' %}">
      <p>Drakos FC</p>
    </div>

    <span class="versus">X</span>

    <div class="time">
      {% if jogo_destaque.times_id_times.url_brasao %}
        <img src="{% static jogo_destaque.times_id_times.url_brasao %}">
      {% else %}
        <img src="{% static 'img/icones/Escudo_Drakos.png' %}">
      {% endif %}
      <p>{{ jogo_destaque.times_id_times.nome_time }}</p>
    </div>
  </div>

  <p class="info-jogo">{{ jogo_destaque.dia_jogo|date:"d/m/Y" }} - {{ jogo_destaque.hora_jogo|time:"H:i" }}</p>
  <p class="info-jogo">{{ jogo_destaque.local_jogo }}</p>
  {% else %}
  <p class="rodada">NENHUM JOGO AGENDADO</p>
  <p class="info-jogo">Aguarde próximos jogos</p>
  {% endif %}
</section>

<!-- ================= COMPRA DE INGRESSOS ================= -->
<main>

  <h1>Compra de Ingressos</h1>

  <section class="titulo-ingresso">
    <h3>Próximo Jogo</h3>
    {% if jogo_destaque %}
      <div class="titulo-ingresso-conteudo">
        <div class="times-ingresso">
          <div class="time">
            <img src="{% static 'img/icones/Escudo_Drakos.png' %}" alt="Escudo Drakos">
            <span>Drakos FC</span>
          </div>

          <div class="versus"><i class="fas fa-times"></i></div>

          <div class="time">
            {% if jogo_destaque.times_id_times.url_brasao %}
              <img src="{% static jogo_destaque.times_id_times.url_brasao %}" alt="Escudo {{ jogo_destaque.times_id_times.nome_time }}">
            {% else %}
              <img src="{% static 'img/icones/Escudo_Drakos.png' %}" alt="Escudo">
            {% endif %}
            <span>{{ jogo_destaque.times_id_times.nome_time }}</span>
          </div>
        </div>

        <div class="detalhes-jogo">
          <p class="info-jogo">{{ jogo_destaque.local_jogo }} • {{ jogo_destaque.dia_jogo|date:"d/m/Y" }} • {{ jogo_destaque.hora_jogo|time:"H:i" }}</p>
        </div>
      </div>
    {% else %}
      <h3>Nenhum jogo disponível</h3>
      <h2>Aguarde os próximos jogos</h2>
    {% endif %}
  </section>

  <div class="container-estadio-ingressos">

    <!-- MAPA -->
    <section class="mapa-estadio">
      <h3>Mapa do Estádio</h3>
      <img src="{% static 'img/icones/estadio_atualizado.png' %}">
    </section>

    <!-- COMPRA -->
    <section class="lado-direito-ingressos">
      <form class="form-setor" method="POST">
        {% csrf_token %}

        <label for="setor">Setor:</label>
        <select id="setor" name="setor" required>
          <option value="">Selecione</option>
          {% for ingresso in ingressos %}
            <option 
              value="{{ ingresso.id_produtos }}"
              data-preco="{{ ingresso.valor_produtos }}">
              {{ ingresso.nome_produtos }} - R$ {{ ingresso.valor_produtos }}
            </option>
          {% endfor %}
        </select>

        <label for="quantidade">Quantidade:</label>
        <input id="quantidade" name="quantidade" type="number" min="0" max="10" value="0" required>

        <button type="submit" class="botao-comprar">
          Adicionar Ingresso
        </button>
      </form>

      <section class="lista-ingressos">
        <h3>Ingressos Selecionados</h3>
        <ul></ul>

        <button type="button" id="btn-finalizar" class="botao-finalizar">
          Finalizar compra • R$ <span id="valor-final">0.00</span>
        </button>
      </section>
    </section>
  </div>

  <!-- ================= PRÓXIMOS JOGOS ================= -->
  <section class="jogos-container">
    <h2 class="titulo-secundario">PRÓXIMOS JOGOS</h2>

    {% for jogo in proximos_jogos %}
    <div class="jogo-card">
      <div class="jogo-times">
        {% if jogo.times_id_times.url_brasao %}
          <img src="{% static jogo.times_id_times.url_brasao %}" class="escudo">
        {% endif %}
      </div>
      <h2>
        {% if jogo.casa_fora == 'casa' %}
          Drakos FC vs {{ jogo.times_id_times.nome_time }}
        {% else %}
          {{ jogo.times_id_times.nome_time }} vs Drakos FC
        {% endif %}
      </h2>
      <p class="data">{{ jogo.dia_jogo|date:"d/m/Y" }} • {{ jogo.hora_jogo|time:"H\hi" }}</p>
      <p class="local">Local: {{ jogo.local_jogo }}</p>
    </div>
    {% empty %}
    <p>Nenhum jogo agendado no momento.</p>
    {% endfor %}
  </section>

  <div id="mensagem-sucesso" class="mensagem-sucesso" style="display:none;">
    Compra realizada com sucesso!
  </div>

</main>

{% endblock conteudo_pagina %}

{% block js_pagina %}
  <script src="{% static 'js/Tela_ingressos.js' %}"></script>
{% endblock js_pagina %}
